# Apache Virtual Host configuration for games.steadiczech.com
# Place this file in /etc/apache2/sites-available/games.steadiczech.com.conf
# Then enable it with: sudo a2ensite games.steadiczech.com.conf

<VirtualHost *:80>
    ServerName games.steadiczech.com
    DocumentRoot /media/server/Storage/www/games.steadiczech.com/html
    
    # Security headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    
    # Main application - serve React app
    <Directory "/media/server/Storage/www/games.steadiczech.com/html">
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Handle React Router - redirect all requests to index.html
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>
    
    # Games directory with proper CORS headers for UE4 games
    <Directory "/media/server/Storage/www/games.steadiczech.com/html/games">
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        
        # CORS headers for UE4 games
        Header always set Cross-Origin-Embedder-Policy "require-corp"
        Header always set Cross-Origin-Opener-Policy "same-origin"
        Header always set Cross-Origin-Resource-Policy "cross-origin"
        
        # Set proper MIME types
        <FilesMatch "\.(wasm)$">
            Header set Content-Type "application/wasm"
            Header always set Cross-Origin-Embedder-Policy "require-corp"
            Header always set Cross-Origin-Opener-Policy "same-origin"
        </FilesMatch>
        
        <FilesMatch "\.(data)$">
            Header set Content-Type "application/octet-stream"
            Header always set Cross-Origin-Embedder-Policy "require-corp"
            Header always set Cross-Origin-Opener-Policy "same-origin"
        </FilesMatch>
        
        <FilesMatch "\.(js)$">
            Header set Content-Type "application/javascript"
        </FilesMatch>
        
        <FilesMatch "\.(css)$">
            Header set Content-Type "text/css"
        </FilesMatch>
        
        <FilesMatch "\.(html)$">
            Header set Content-Type "text/html"
        </FilesMatch>
        
        <FilesMatch "\.(png|jpg|jpeg|gif)$">
            Header set Content-Type "image/png"
        </FilesMatch>
    </Directory>
    
    # API routes - proxy to Node.js server
    <Location "/api/">
        ProxyPass http://localhost:3002/
        ProxyPassReverse http://localhost:3002/
        ProxyPreserveHost On
        
        # CORS headers for API
        Header always set Access-Control-Allow-Origin "*"
        Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Header always set Access-Control-Allow-Headers "Content-Type"
        
        # Handle preflight requests
        RewriteEngine On
        RewriteCond %{REQUEST_METHOD} OPTIONS
        RewriteRule ^(.*)$ $1 [R=200,L]
    </Location>
    
    # Cache static assets
    <LocationMatch "\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
        ExpiresActive On
        ExpiresDefault "access plus 1 year"
        Header set Cache-Control "public, immutable"
    </LocationMatch>
    
    # Error pages
    ErrorDocument 404 /index.html
    ErrorDocument 500 /index.html
</VirtualHost>

# Optional: HTTPS configuration (uncomment and configure if you have SSL certificates)
# <VirtualHost *:443>
#     ServerName games.steadiczech.com
#     DocumentRoot /media/server/Storage/www/games.steadiczech.com/html
#     
#     SSLEngine on
#     SSLCertificateFile /path/to/your/certificate.crt
#     SSLCertificateKeyFile /path/to/your/private.key
#     
#     # Include the same directory and location blocks as above
#     # ... (copy all Directory and Location blocks from above)
# </VirtualHost>
